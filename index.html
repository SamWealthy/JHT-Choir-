<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="styles.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Backup Singers List Generator</title>
  <style>
    /* Google Font for a modern look */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      font-weight: 600;
      color: #222;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }

    form {
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }

    form:hover {
      transform: translateY(-2px);
    }

    label {
      display: block;
      margin-top: 18px;
      font-weight: 600;
      font-size: 0.95rem;
      color: #444;
    }

    textarea, input[type="datetime-local"] {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border: 1px solid #d0d0d0;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 0.95rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    textarea:focus, input[type="datetime-local"]:focus {
      border-color: #007bff;
      box-shadow: 0 0 6px rgba(0,123,255,0.2);
      outline: none;
    }

    textarea {
      resize: vertical;
    }

    .button-container {
      display: flex;
      gap: 12px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    button:disabled {
      background-color: #d6d6d6;
      color: #777;
      cursor: not-allowed;
    }

    button:nth-child(1) {
      background: #007bff;
      color: white;
    }
    button:nth-child(1):hover:enabled {
      background: #0056b3;
    }

    #copyButton {
      background: #28a745;
      color: white;
    }
    #copyButton:hover:enabled {
      background: #1e7e34;
    }

    #clearHistoryButton {
      background: #dc3545;
      color: white;
    }
    #clearHistoryButton:hover:enabled {
      background: #a71d2a;
    }

    #output {
      margin-top: 25px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      white-space: pre-wrap;
      font-family: monospace;
      line-height: 1.5;
    }

    #manualCopy {
      margin-top: 15px;
      display: none;
    }
    #manualCopy textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
      border-radius: 8px;
      padding: 10px;
    }

    #history {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    #history h2 {
      margin-top: 0;
      font-size: 1.2rem;
      border-bottom: 2px solid #eee;
      padding-bottom: 8px;
    }

    .history-entry {
      margin-bottom: 20px;
      padding: 12px;
      border-left: 4px solid #007bff;
      background: #f9f9ff;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .history-entry:hover {
      background: #f1f1ff;
    }

    .history-entry pre {
      white-space: pre-wrap;
      font-family: monospace;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
      margin-top: 6px;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.4rem;
      }
      textarea, input[type="datetime-local"] {
        font-size: 14px;
      }
      .button-container {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<script defer src="app.js"></script>
<body>
  <h1>🎶 JHT Choir Weekly Backup Singers List</h1>
  <form id="singerForm">
    <label for="timestamp">Select Date and Time for List (optional):</label>
    <input type="datetime-local" id="timestamp">

    <label for="firstPraise">FIRST SERVICE PRAISE AND WORSHIP (Enter names, one per line):</label>
    <textarea id="firstPraise" rows="4" placeholder="e.g. Alice Johnson\nBob Smith"></textarea>

    <label for="firstSpecial">FIRST SERVICE SPECIAL NO (Enter names, one per line):</label>
    <textarea id="firstSpecial" rows="4" placeholder="e.g. Carol Davis\nDavid Wilson"></textarea>

    <label for="secondPraise">SECOND SERVICE PRAISE AND WORSHIP (Enter names, one per line):</label>
    <textarea id="secondPraise" rows="4" placeholder="e.g. Emma Brown\nFrank Miller"></textarea>

    <label for="secondSpecial">SECOND SERVICE SPECIAL NO (Enter names, one per line):</label>
    <textarea id="secondSpecial" rows="4" placeholder="e.g. Grace Lee\nHenry Taylor"></textarea>

    <div class="button-container">
      <button type="button" onclick="generateList()">Generate List</button>
      <button type="button" id="copyButton" onclick="copyToClipboard()" disabled>Copy to Clipboard</button>
      <button type="button" id="clearHistoryButton" onclick="clearHistory()">Clear History</button>
    </div>
  </form>

  <div id="output"></div>
  <div id="manualCopy">
    <p>Clipboard access failed. Select and copy the text below manually:</p>
    <textarea id="manualCopyText" readonly></textarea>
  </div>
  <div id="history"></div>

  <script>
    let outputText = '';

    function generateList() {
      const timestampInput = document.getElementById('timestamp').value;
      const timestamp = timestampInput ? new Date(timestampInput).toISOString() : new Date().toISOString();
      const firstPraise = document.getElementById('firstPraise').value.trim().split('\n').filter(name => name.trim());
      const firstSpecial = document.getElementById('firstSpecial').value.trim().split('\n').filter(name => name.trim());
      const secondPraise = document.getElementById('secondPraise').value.trim().split('\n').filter(name => name.trim());
      const secondSpecial = document.getElementById('secondSpecial').value.trim().split('\n').filter(name => name.trim());

      outputText = '';

      if (firstPraise.length > 0) {
        outputText += 'FIRST SERVICE PRAISE AND WORSHIP:\n';
        firstPraise.forEach(name => {
          outputText += `  - ${name.trim()}\n`;
        });
        outputText += '\n';
      }

      if (firstSpecial.length > 0) {
        outputText += 'FIRST SERVICE SPECIAL NO:\n';
        firstSpecial.forEach(name => {
          outputText += `  - ${name.trim()}\n`;
        });
        outputText += '\n';
      }

      if (secondPraise.length > 0) {
        outputText += 'SECOND SERVICE PRAISE AND WORSHIP:\n';
        secondPraise.forEach(name => {
          outputText += `  - ${name.trim()}\n`;
        });
        outputText += '\n';
      }

      if (secondSpecial.length > 0) {
        outputText += 'SECOND SERVICE SPECIAL NO:\n';
        secondSpecial.forEach(name => {
          outputText += `  - ${name.trim()}\n`;
        });
      }

      document.getElementById('output').innerText = outputText || 'No names entered.';
      document.getElementById('copyButton').disabled = !outputText;
      document.getElementById('manualCopy').style.display = 'none';

      if (outputText) {
        saveToHistory(outputText, timestamp);
      }
      displayHistory();
    }

    function copyToClipboard() {
      if (!outputText) return;

      const manualCopyDiv = document.getElementById('manualCopy');
      manualCopyDiv.style.display = 'none';

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(outputText).then(() => {
          alert('✅ List copied to clipboard!');
        }).catch(err => {
          console.error('Clipboard API failed:', err);
          fallbackCopyToClipboard(outputText);
        });
      } else {
        fallbackCopyToClipboard(outputText);
      }
    }

    function fallbackCopyToClipboard(text) {
      try {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        const success = document.execCommand('copy');
        document.body.removeChild(textarea);
        if (success) {
          alert('✅ List copied to clipboard!');
        } else {
          showManualCopy(text);
        }
      } catch (err) {
        console.error('Fallback copy failed:', err);
        showManualCopy(text);
      }
    }

    function showManualCopy(text) {
      const manualCopyDiv = document.getElementById('manualCopy');
      const manualCopyText = document.getElementById('manualCopyText');
      manualCopyText.value = text;
      manualCopyDiv.style.display = 'block';
      alert('⚠️ Clipboard access failed. Please copy manually.');
    }

    function saveToHistory(text, timestamp) {
      let history = JSON.parse(localStorage.getItem('singerHistory') || '[]');
      history.unshift({ timestamp, text });
      const twoWeeksAgo = new Date();
      twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
      history = history.filter(entry => new Date(entry.timestamp) >= twoWeeksAgo);
      history = history.slice(0, 2);
      localStorage.setItem('singerHistory', JSON.stringify(history));
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('singerHistory') || '[]');
      let historyHtml = '<h2>History (Last 2 Weeks)</h2>';
      if (history.length === 0) {
        historyHtml += '<p>No history available.</p>';
      } else {
        history.forEach(entry => {
          const date = new Date(entry.timestamp).toLocaleString();
          historyHtml += `<div class="history-entry"><h3>Generated on ${date}</h3><pre>${entry.text}</pre></div>`;
        });
      }
      document.getElementById('history').innerHTML = historyHtml;
      document.getElementById('clearHistoryButton').disabled = history.length === 0;
    }

    function clearHistory() {
      if (confirm('Are you sure you want to clear the history?')) {
        localStorage.removeItem('singerHistory');
        displayHistory();
        alert('🗑️ History cleared!');
      }
    }

    window.onload = displayHistory;
  </script>
</body>
</html>
